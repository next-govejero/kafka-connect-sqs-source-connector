# Kafka Connect SQS Source Connector - EventBridge with Decompression
#
# This example demonstrates decompressing EventBridge events where the
# detail.data field contains gzip-compressed and Base64-encoded JSON data.
#
# Use case: AWS EventBridge sends events to SQS with compressed payload data
# to reduce message sizes and costs.

# Connector Configuration
name=sqs-eventbridge-decompression-connector
connector.class=io.connect.sqs.SqsSourceConnector
tasks.max=1

# AWS Configuration
aws.region=us-east-1
# Leave empty to use IAM role / instance profile
aws.access.key.id=
aws.secret.access.key=

# SQS Configuration
sqs.queue.url=https://sqs.us-east-1.amazonaws.com/123456789/eventbridge-events
sqs.max.messages=10
sqs.wait.time.seconds=20
sqs.visibility.timeout.seconds=30
sqs.delete.messages=true

# Kafka Configuration
kafka.topic=eventbridge-events-decompressed
# Optional: specify partition
# kafka.topic.partition=0

# SCRAM Authentication (Mandatory)
sasl.mechanism=SCRAM-SHA-512
security.protocol=SASL_SSL
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
  username="kafka-connect-user" \
  password="${env:KAFKA_PASSWORD}";

# Message Decompression Configuration
# Use the DecompressingMessageConverter to handle compressed data
message.converter.class=io.connect.sqs.converter.DecompressingMessageConverter

# Delegate to DefaultMessageConverter after decompression
message.decompression.delegate.converter.class=io.connect.sqs.converter.DefaultMessageConverter

# Decompress the nested field 'detail.data' in EventBridge events
message.decompression.field.path=detail.data

# Auto-detect compression format (gzip, deflate, zlib)
message.decompression.format=AUTO

# Enable Base64 decoding (compressed data in JSON is typically Base64-encoded)
message.decompression.base64.decode=true

# Field Extraction Configuration (Optional)
# Extract only the 'detail.data' field from the final message, removing EventBridge envelope
# message.output.field.extract=detail.data
# message.output.field.extract.failOnMissing=false

# Error Handling
dlq.topic=eventbridge-events-dlq
max.retries=3
retry.backoff.ms=1000

# Example EventBridge event structure:
# {
#   "version": "0",
#   "id": "event-id",
#   "detail-type": "PriceCache.Updated",
#   "source": "PriceCacheService",
#   "account": "891377401540",
#   "time": "2025-11-18T07:20:37Z",
#   "region": "eu-west-1",
#   "detail": {
#     "specversion": "1.0",
#     "id": "event-123",
#     "source": "PriceCacheService",
#     "type": "PriceCache.Updated",
#     "datacontenttype": "json",
#     "time": "2025-11-18T07:20:36Z",
#     "data": "H4sIAAAAAAAA/6tWKkktLlGyUlAqS8wpTtVRKi1OLYrPTSwpSs2zUgKpBQBZvhNoIwAAAA=="
#   }
# }
#
# After decompression, detail.data will contain the actual JSON:
# "data": "{\"price\":100,\"currency\":\"USD\",\"timestamp\":1234567890}"
