# Kafka Connect SQS Source Connector - EventBridge with Field Extraction
#
# This example demonstrates extracting nested fields from EventBridge events.
# Use case: Extract only the 'detail.data' field from EventBridge messages,
# removing the EventBridge envelope (version, id, detail-type, etc.)
#
# This makes EventBridge-based topics match direct data topics by extracting
# just the business data from the event wrapper.

# Connector Configuration
name=sqs-eventbridge-field-extraction-connector
connector.class=io.connect.sqs.SqsSourceConnector
tasks.max=1

# AWS Configuration
aws.region=us-east-1
# Leave empty to use IAM role / instance profile
aws.access.key.id=
aws.secret.access.key=

# SQS Configuration
sqs.queue.url=https://sqs.us-east-1.amazonaws.com/123456789/eventbridge-events
sqs.max.messages=10
sqs.wait.time.seconds=20
sqs.visibility.timeout.seconds=30
sqs.delete.messages=true

# Kafka Configuration
kafka.topic=business-data-extracted
# Optional: specify partition
# kafka.topic.partition=0

# SCRAM Authentication (Mandatory)
sasl.mechanism=SCRAM-SHA-512
security.protocol=SASL_SSL
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
  username="kafka-connect-user" \
  password="${env:KAFKA_PASSWORD}";

# Message Converter Configuration
message.converter.class=io.connect.sqs.converter.DefaultMessageConverter

# Field Extraction Configuration
# Extract only the 'detail.data' field from the EventBridge message
# This removes all EventBridge metadata and sends only the business data to Kafka
message.output.field.extract=detail.data

# Return original message if field not found (set to true to fail on missing field)
message.output.field.extract.failOnMissing=false

# Error Handling
dlq.topic=business-data-dlq
max.retries=3
retry.backoff.ms=1000

# Example EventBridge event structure:
# {
#   "version": "0",
#   "id": "event-123",
#   "detail-type": "FlightOffersUpdate",
#   "source": "OffersService",
#   "account": "123456789",
#   "time": "2025-11-27T12:00:00Z",
#   "region": "eu-west-1",
#   "detail": {
#     "data": {
#       "offers": [
#         {"id": "123", "price": 100.50, "airline": "IB"}
#       ]
#     }
#   }
# }
#
# After field extraction, only this will be sent to Kafka:
# {
#   "offers": [
#     {"id": "123", "price": 100.50, "airline": "IB"}
#   ]
# }
